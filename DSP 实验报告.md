# 1. 实验背景与目的
语音是人类最自然、最便捷的交流方式。然而，在实际应用中，语音信号常常会受到各种噪声的干扰，例如环境噪声、电流声等，这些噪声会严重影响语音的清晰度和可懂度，甚至导致信息传递的失败。数字信号处理（DSP）技术为解决这些问题提供了强有力的手段，特别是数字滤波器在语音增强和噪声抑制方面扮演着至关重要的角色。通过设计合适的数字滤波器，可以有效地分离语音信号和噪声信号，从而改善语音质量。
实验要求：
1. 语音信号的采集与频域分析：自己的语音信号采集到电脑，用Matlab对其进行频域分析，画出频谱图，并分析不同声音的频谱区别
2. IIR数字滤波器设计：
本实验旨在通过实际操作，掌握数字语音信号处理的基本流程和核心技术。具体目的包括：
3. 学习加载和分析数字语音信号的基本方法，理解信号在时域和频域的表示方式。
4. 理解噪声对语音信号的影响，并学习如何向语音信号中添加特定类型的噪声（如高斯白噪声）以模拟实际情况。
5. 掌握无限冲激响应（IIR）滤波器和有限冲激响应（FIR）滤波器的基本原理和设计方法。
 6. 学习应用设计的数字滤波器对含噪语音信号进行滤波处理，以达到去噪和增强语音的目的。
 7. 通过对比滤波前后的信号波形和频谱，直观地评估滤波效果，加深对滤波器特性及其在语音处理中应用的理解。
8. 熟悉常用的信号处理工具和库（如 Python 中的 Librosa, SciPy, NumPy, Matplotlib）。

---

# 2. 实验原理

## 2.1. 语音信号及其特性
语音信号是一种复杂的非平稳时变信号，其特性随时间快速变化。

* **时域表示：** 语音信号在时域上表现为幅度随时间变化的波形。通过观察波形，可以大致了解语音的能量起伏、清浊音段等。`load.py` 脚本中使用 `librosa.display.waveshow()` 来可视化时域波形。
* **频域表示 (FFT)：** 为了分析语音信号的频率成分，通常采用快速傅里叶变换（FFT）。FFT可以将时域信号转换到频域，显示信号在不同频率点上的能量分布。这有助于识别语音的共振峰、基频等重要特征。`load.py` 中使用 `np.fft.rfft()` 计算并绘制频谱图。
* **语谱图 (Spectrogram)：** 语谱图是一种二维的图形表示，它结合了时域和频域信息，能够显示语音信号频谱随时间的变化情况。横轴表示时间，纵轴表示频率，颜色的深浅或亮度表示该频率点在该时刻的能量强度。`load.py` 中使用 `signal.spectrogram()` 生成语谱图数据，并用 `plt.pcolormesh()` 进行可视化。

## 2.2. 噪声模型
实验中主要使用**高斯白噪声 (Gaussian White Noise)**。
* **高斯性：** 噪声的瞬时幅度值服从高斯分布（正态分布）。这意味着较小的幅度值出现的概率较高，而较大的幅度值出现的概率较低。
* **白噪声：** 噪声的功率谱密度在整个频带内是均匀分布的，即所有频率分量具有相同的平均功率。在时域上，白噪声的自相关函数在零延迟处为狄拉克$\delta$函数，在其他延迟处为零。
在 `Adding Noise and Filtering.py` 脚本中，通过 `noise = np.random.normal(0, np.sqrt(noise_power), len(y))` 生成高斯白噪声，其中 `noise_power` 控制噪声的功率。

## 2.3. 数字滤波器原理

数字滤波器是一种数学算法，它对数字信号进行操作以修改或增强信号的某些方面。本实验涉及两种主要的线性时不变数字滤波器：IIR 滤波器和 FIR 滤波器。

* **IIR (Infinite Impulse Response) 滤波器：**
    * **定义：** IIR 滤波器的冲激响应是无限长的。其输出不仅与当前和过去的输入有关，还与过去的输出有关（即包含反馈环节）。
    * **差分方程：** $y[n] = \sum_{k=0}^{M} b_k x[n-k] - \sum_{j=1}^{N} a_j y[n-j]$
    * **传递函数：** $H(z) = \frac{\sum_{k=0}^{M} b_k z^{-k}}{1 + \sum_{j=1}^{N} a_j z^{-j}}$
    * **特点：**
        * 可以用较低的阶数获得较高的频率选择性，计算量相对较小。
        * 可能存在稳定性问题，相位通常是非线性的。
    * **设计方法：** 本实验采用**巴特沃斯 (Butterworth)** 滤波器设计。巴特沃斯滤波器的特点是在通带内具有最大平坦的幅度响应，在阻带单调下降。`IIR_filter.py` 中的 `design_iir_filter` 函数使用 `scipy.signal.butter()` 进行设计。 归一化截止频率 $W_n$ 的计算方式为 $W_n = \frac{2 \times \text{cutoff\_freq\_iir}}{\text{sr}}$ （对于低通和高通）。

* **FIR (Finite Impulse Response) 滤波器：**
    * **定义：** FIR 滤波器的冲激响应是有限长的。其输出仅与当前和过去的输入有关（无反馈）。
    * **差分方程：** $y[n] = \sum_{k=0}^{N-1} b_k x[n-k]$ (其中 N 为滤波器长度或抽头数)
    * **传递函数：** $H(z) = \sum_{k=0}^{N-1} b_k z^{-k}$
    * **特点：**
        * 总是稳定的。
        * 易于设计成具有精确的线性相位，这在许多应用中（如语音和图像处理）非常重要，因为它能避免相位失真。
        * 通常需要比 IIR 滤波器更高的阶数才能达到相同的频率选择性，计算量可能较大。
    * **设计方法：** 本实验采用**窗函数法**，具体使用的是**汉明窗 (Hamming window)**。窗函数法通过对理想滤波器的冲激响应进行加窗来获得有限长的冲激响应。汉明窗能提供较好的旁瓣抑制。`FIR_filter.py` 中的 `design_fir_filter` 函数使用 `scipy.signal.firwin()` 进行设计。 对于 `firwin` 函数，截止频率是相对于奈奎斯特频率 ($sr/2$) 进行归一化的，即 $normalized\_cutoff\_fir = \frac{\text{cutoff\_freq\_fir}}{sr/2.0}$。 滤波器阶数为 `numtaps_fir - 1`。

滤波操作通过 `scipy.signal.lfilter(b, a, signal_to_filter)` 函数实现，其中 `b` 和 `a` 分别是滤波器的分子和分母系数。对于 FIR 滤波器，`a` 通常是 `1.0`。

---

# 3. 实验操作步骤与代码说明

本实验通过一系列 Python 脚本完成，主要包括音频加载与分析、滤波器设计、添加噪声以及滤波处理。

1.  **环境准备与依赖库安装：**
    确保已安装 Python 环境以及以下核心库：`librosa`, `numpy`, `matplotlib`, `scipy`。可以使用 pip 进行安装：
    ```bash
    pip install librosa numpy matplotlib scipy
    ```
    脚本中已设置 `matplotlib` 以支持中文显示。

2.  **加载音频并进行初步分析 (`load.py`)：**
    * **加载音频：** 使用 `librosa.load('your_audio.wav', sr=None)` 加载名为 `your_audio.wav` 的音频文件。 `sr=None` 参数确保保留音频原始的采样率。
    * **显示波形：** 调用 `librosa.display.waveshow(y, sr=sr)` 绘制并显示语音信号的时域波形。
    * **显示FFT频谱：** 使用 `np.fft.rfft(y)` 计算实信号的FFT，`np.fft.rfftfreq(len(y), d=1/sr)` 计算对应的频率点，然后绘制频谱图。
    * **显示语谱图：** 利用 `scipy.signal.spectrogram(y, fs=sr)` 计算语谱图数据，再通过 `plt.pcolormesh()` 进行可视化。
    * *实验日志 (`Experiment Log.md`) 中记录了此阶段的波形图、FFT频谱图和语谱图。*

3.  **IIR 滤波器设计与特性分析 (`IIR_filter.py`)：**
    * 该脚本的核心是 `design_iir_filter` 函数，它根据指定的采样率 `sr`、滤波器类型 `filter_type_iir` (如 'lowpass')、截止频率 `cutoff_freq_iir` 和阶数 `order_iir` 来设计巴特沃斯IIR滤波器，返回滤波器系数 `b_iir`, `a_iir` 和描述信息。
    * 脚本的 `if __name__ == "__main__":` 部分演示了如何调用此函数设计一个低通滤波器（默认截止频率3000Hz，4阶），并使用 `scipy.signal.freqz()` 计算其频率响应。
    * 绘制并显示滤波器的幅度响应和对数幅度响应（dB）。
    * *实验日志中包含了IIR低通滤波器的幅度响应和对数幅度响应图。*

4.  **FIR 滤波器设计与特性分析 (`FIR_filter.py`)：**
    * `design_fir_filter` 函数负责设计FIR滤波器。它接收采样率 `sr`、滤波器类型 `filter_type_fir`、抽头数 `numtaps_fir` (要求为奇数以保证线性相位)、截止频率 `cutoff_freq_fir` 等参数，使用汉明窗 `window='hamming'` 进行设计，返回滤波器系数 `b_fir` (`a_fir` 为1.0) 和描述信息。
    * 脚本的 `if __name__ == "__main__":` 部分演示了如何设计一个低通FIR滤波器（默认101抽头，截止频率3000Hz），并计算和绘制其频率响应。
    * *实验日志中包含了FIR低通滤波器的幅度响应和对数幅度响应图。*

5.  **添加噪声与滤波处理 (`Adding Noise and Filtering.py`)：**
    * **加载原始音频：** `y, sr = librosa.load(audio_filename, sr=None)`。
    * **生成并添加高斯白噪声：**
        ```python
        noise_power = 0.005  # 噪声功率
        noise = np.random.normal(0, np.sqrt(noise_power), len(y))
        y_noisy = y + noise
        ```
       
    * **保存含噪音频：** `wavfile.write('.\\wav\\audio_noisy.wav', sr, (y_noisy * 32767).astype(np.int16))`。
    * **选择待滤波信号：** `signal_to_filter = y_noisy`。
    * **显示含噪信号波形与频谱：** 绘制 `signal_to_filter` 的时域波形和FFT频谱。 *结果见实验日志中的“含噪语音信号 - 波形与FFT”。*
    * **设计IIR滤波器：**
        ```python
        filter_type_iir = 'lowpass'
        cutoff_freq_iir = 5000
        order_iir = 4
        b_iir, a_iir, filter_desc_iir = design_iir_filter(sr, filter_type_iir, cutoff_freq_iir, order_iir)
        ```
       
    * **应用IIR滤波器：** `y_filtered_iir = signal.lfilter(b_iir, a_iir, signal_to_filter)`。
    * **显示IIR滤波后信号波形与频谱：** 绘制 `y_filtered_iir` 的时域波形和FFT频谱。 *结果见实验日志中的“IIR 低通滤波后 - 波形与FFT”。*
    * **设计FIR滤波器：**
        ```python
        filter_type_fir = 'lowpass'
        numtaps_fir = 101
        cutoff_freq_fir = 5000
        # ... (其他参数如 lowcut_fir, highcut_fir 在低通时可能不直接使用，但函数定义需要)
        b_fir, a_fir, filter_desc_fir, cutoff_freq_fir, lowcut_fir, highcut_fir = design_fir_filter(sr, filter_type_fir, numtaps_fir, cutoff_freq_fir, lowcut_fir, highcut_fir)
        ```
       
    * **应用FIR滤波器：** `y_filtered_fir = signal.lfilter(b_fir, a_fir, signal_to_filter)`。
    * **显示FIR滤波后信号波形与频谱：** 绘制 `y_filtered_fir` 的时域波形和FFT频谱。 *结果见实验日志中的“FIR 低通滤波后 - 波形与FFT”。*
    * 脚本中预留了保存滤波后音频的代码行，但默认被注释掉了。

---

# 4. 实验结果与分析 

通过本次实验，我对语音信号的数字处理有了更深入和直观的理解，主要收获和体会如下：

* **语音信号的多面性：** 深刻体会到从不同域（时域、频域、时频域）观察和分析语音信号的重要性。时域波形能直观反映信号的幅度变化，但难以看出频率成分；FFT频谱则清晰展示了信号的频率构成，是滤波器设计和效果评估的关键；语谱图则动态地展现了语音的频谱随时间演变的复杂特性，对于理解语音内容的声学特征非常有帮助。

* **噪声的感知与量化：** 通过向原始语音中添加高斯白噪声，我直观地感受到了噪声对语音质量的劣化作用。在时域波形上，噪声使得信号整体显得更加杂乱无章；在频域上，白噪声的引入使得整个频谱的基底抬高，掩盖了部分语音信号的细节。`noise_power` 参数的调整也让我理解了噪声强度对信号的影响程度。

* **滤波器设计的权衡：**
    * **IIR vs. FIR：** 实验中设计并应用了IIR（巴特沃斯）和FIR（汉明窗）两种滤波器。我理解到IIR滤波器可以用较低的阶数实现较陡峭的过渡带，计算效率较高，但其非线性相位可能引入相位失真。而FIR滤波器虽然通常需要更高的阶数（如本例中FIR用了101阶，IIR用了4阶），但可以方便地设计成线性相位，保证信号各频率分量的时间延迟一致，这对于保持语音的自然度很重要。
    * **参数选择：** 滤波器的参数选择（如截止频率、阶数/抽头数）对滤波效果至关重要。在`Adding Noise and Filtering.py`中，IIR和FIR低通滤波器的截止频率都设为5000Hz。 若截止频率设置过低，虽然能去除更多高频噪声，但也可能损伤语音中的高频成分，导致声音沉闷；若设置过高，则去噪效果不明显。阶数/抽头数越高，滤波器的过渡带越窄，性能越好，但计算复杂度也随之增加。这是一个需要在实际应用中根据需求进行权衡的过程。

* **滤波效果的直观评估：** 对比含噪信号与滤波后信号的波形和频谱图，可以清晰地看到滤波器的作用。在`Experiment Log.md`中的“IIR 低通滤波后 - 波形与FFT”和“FIR 低通滤波后 - 波形与FFT”图示中，滤波后信号频谱图在高频区域的幅度明显降低，表明高频噪声得到了有效抑制。时域波形也相对变得平滑一些。如果取消注释并保存滤波后的音频文件，通过听觉对比也能主观评价滤波效果。

* **理论与实践的结合：** 本实验将数字信号处理的理论知识（如傅里叶变换、滤波器原理、窗函数等）与编程实践紧密结合。通过编写和调试代码，我对这些理论概念的理解更加深刻和具体。例如，通过`scipy.signal.freqz`观察滤波器的实际频率响应，与理论上的理想特性进行对比，有助于理解设计过程中的近似和误差。

* **工具库的强大与便捷：** 实验过程中大量使用了Python的科学计算库。`Librosa`在音频加载和时域显示方面功能强大，`NumPy`为数组运算提供了高效支持，`SciPy`的`signal`模块则集成了丰富的滤波器设计、频谱分析等工具，`Matplotlib`则为数据可视化提供了便利。这些工具极大地简化了数字信号处理的实现过程。

总而言之，这次实验不仅让我掌握了语音信号加噪和滤波的基本技术流程，更重要的是培养了分析问题、设计方案和评估效果的综合能力，为后续更复杂的信号处理任务打下了坚实的基础。